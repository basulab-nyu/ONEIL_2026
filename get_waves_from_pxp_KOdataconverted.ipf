#pragma rtGlobals=1Macro get_waves_from_pxp()pget_waves_from_pxp()proc pget_waves_from_pxp(str_root_path,str_file_match,str_igordir_match,str_wave_match,str_mode,str_recursive)string str_root_pathprompt str_root_path "root path ?"string str_file_matchprompt str_file_match "target files [grep - textwave]?"string str_igordir_matchprompt str_igordir_match "target igor folders ?" // not testedstring str_wave_matchprompt str_wave_match "target waves [grep - eg (?i)str or ^(?i)str or (?i)str$] ?"string str_modeprompt str_mode "match (1) or antimatch (0) ?"string str_recursiveprompt str_recursive "recursive (1) or not (0) ?"killvariables/a/zkillstrings/a/zkillpath/a/zif(strlen(str_root_path) == 0)	str_root_path = "R:basulab:basulabspace:KO:MEC_LEC_CA3:data_converted:"endifif(stringmatch(str_root_path[strlen(str_root_path)-1,inf],":") == 0)	str_root_path = str_root_path+":"endifnewpath/o/q p_root_path, str_root_pathstring/g str_reg_dir = "^(?i)[[:digit:]]{8}+_+[[:alpha:]]{2}+[[:digit:]]{1,3}$"string/g str_reg_subdir = "^(?i)[[:digit:]]{8}+_+[[:alpha:]]{2}+[[:digit:]]{1,3}+_+[[:alpha:]]{1}+[[:digit:]]{1}+[[:alpha:]]{1}+[[:digit:]]{1,2}"string/g str_reg_files = "^(?i)[[:digit:]]{8}+_+[[:alpha:]]{2}+[[:digit:]]{1,3}+_+[[:alpha:]]{1}+[[:digit:]]{1}+[[:alpha:]]{1}+[[:digit:]]{1,2}"string/g str_reg_waves = str_wave_matchif(strlen(str_file_match) == 0)		make/n=1/t/o w_match_t = {str_reg_files}	else	 duplicate/o $str_file_match w_match_tendifif(strlen(str_mode) == 0)	variable/g var_mode = 1else	variable/g var_mode = str2num(str_mode)endifif(strlen(str_recursive) == 0)	variable/g var_recursive = 0else	variable/g var_recursive = str2num(str_recursive)endifprint "\nlisting files..."variable/g var_timer = StartMSTimerstring/g str_root_dir_list = sortlist(indexeddir(p_root_path,-1,0),";",16)string/g str_full_dir_listvariable/g var_root_scroll = 0do	if(grepstring(stringfromlist(var_root_scroll,str_root_dir_list),str_reg_dir) == 1)		string/g str_child_path = str_root_path+stringfromlist(var_root_scroll,str_root_dir_list)		newpath/o/q p_child_path, str_child_path		string/g str_child_dir_list = sortlist(indexeddir(p_child_path,-1,0),";",16)		variable/g var_child_scroll = 0		do			if(grepstring(stringfromlist(var_child_scroll,str_child_dir_list),str_reg_subdir) == 1)				if(strlen(str_full_dir_list) == 0)					str_full_dir_list = str_child_path+":"+stringfromlist(var_child_scroll,str_child_dir_list)				else					str_full_dir_list = str_full_dir_list+";"+str_child_path+":"+stringfromlist(var_child_scroll,str_child_dir_list)				endif			endif			var_child_scroll+=1		while(var_child_scroll<itemsinlist(str_child_dir_list))	endif	var_root_scroll+=1while(var_root_scroll<itemsinlist(str_root_dir_list))string/g str_full_file_liststring/g str_path_liststring/g str_pxp_listvariable/g var_dir_scroll = 0do	newpath/o/q p_file, stringfromlist(var_dir_scroll,str_full_dir_list)	string/g str_file_list = sortlist(indexedfile(p_file,-1,".pxp"),";",16)	if(itemsinlist(str_file_list)>0)		variable/g var_file_scroll = 0		do			if(grepstring(stringfromlist(var_file_scroll,str_file_list),str_reg_files) == 1)				variable/g var_match = 0				do					if(grepstring(stringfromlist(var_file_scroll,str_file_list),w_match_t[var_match]) == 1)						if(strlen(str_full_file_list) == 0)							str_full_file_list = stringfromlist(var_dir_scroll,str_full_dir_list)+":"+stringfromlist(var_file_scroll,str_file_list)							str_path_list = stringfromlist(var_dir_scroll,str_full_dir_list)							str_pxp_list = stringfromlist(var_file_scroll,str_file_list)						else							str_full_file_list = str_full_file_list+";"+stringfromlist(var_dir_scroll,str_full_dir_list)+":"+stringfromlist(var_file_scroll,str_file_list)							str_path_list = str_path_list+";"+stringfromlist(var_dir_scroll,str_full_dir_list)							str_pxp_list = str_pxp_list+";"+stringfromlist(var_file_scroll,str_file_list)						endif					endif					var_match+=1				while(var_match<numpnts(w_match_t))			endif			var_file_scroll+=1		while(var_file_scroll<itemsinlist(str_file_list))	endif	var_dir_scroll+=1while(var_dir_scroll<itemsinlist(str_full_dir_list))print replacestring(";",str_full_file_list,"\r")print "\nfiles listed!!!"killwaves/z w_match_tprint "\ntime elapsed = "+num2str(stopMSTimer(var_timer)/1000000)+"s"print "\nloading waves..."variable/g var_timer = StartMSTimervariable/g var_get = 0do	newpath/o/q p_get, stringfromlist(var_get,str_path_list)	print "\nworking on "+stringfromlist(var_get,str_path_list)	if(var_mode == 1 && var_recursive == 1 && strlen(str_igordir_match)==0)		loaddata/grep={str_reg_waves,1,1,0}/l=1/p=p_get/q/r/t stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 1 && var_recursive == 0 && strlen(str_igordir_match)==0)		loaddata/grep={str_reg_waves,1,1,0}/l=1/p=p_get/q/t stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 0 && var_recursive == 1 && strlen(str_igordir_match)==0)		loaddata/grep={str_reg_waves,1,1,1}/l=1/p=p_get/q/r/t stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 0 && var_recursive == 0 && strlen(str_igordir_match)==0)		loaddata/grep={str_reg_waves,1,1,1}/l=1/p=p_get/q/t stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 1 && var_recursive == 1 && strlen(str_igordir_match)>0)		loaddata/grep={str_reg_waves,1,1,0}/l=1/p=p_get/q/r/t/s=str_igordir_match stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 1 && var_recursive == 0 && strlen(str_igordir_match)>0)		loaddata/grep={str_reg_waves,1,1,0}/l=1/p=p_get/q/t/s=str_igordir_match stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 0 && var_recursive == 1 && strlen(str_igordir_match)>0)		loaddata/grep={str_reg_waves,1,1,1}/l=1/p=p_get/q/r/t/s=str_igordir_match stringfromlist(var_get,str_pxp_list)	endif	if(var_mode == 0 && var_recursive == 0 && strlen(str_igordir_match)>0)		loaddata/grep={str_reg_waves,1,1,1}/l=1/p=p_get/q/t/s=str_igordir_match stringfromlist(var_get,str_pxp_list)	endif	var_get+=1while(var_get<itemsinlist(str_full_file_list))print "\nwaves loaded!!!"print "\ntime elapsed = "+num2str(stopMSTimer(var_timer)/60000000)+"min"end